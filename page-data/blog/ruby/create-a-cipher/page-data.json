{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/ruby/create-a-cipher/","result":{"data":{"site":{"siteMetadata":{"title":"Kevin Ponce Blog","author":"Kevin Ponce"}},"markdownRemark":{"id":"e8dd6f30-e230-5d95-8bcd-132131cbc092","excerpt":"Cipher is a great way to encrypt and decrypt data.\nHere is some code on how to create a cipher in ruby. Example of how to use it:","html":"<p>Cipher is a great way to encrypt and decrypt data.\nHere is some code on how to create a cipher in ruby.</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">CipherService</span>\n  attr_accessor <span class=\"token symbol\">:key</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:vector</span>\n\n  <span class=\"token comment\"># key = SecureRandom.urlsafe_base64(24)</span>\n  <span class=\"token comment\"># vector = SecureRandom.urlsafe_base64(9)</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">initialize</span></span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> vector<span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>key <span class=\"token operator\">=</span> key\n    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>vector <span class=\"token operator\">=</span> vector\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">encrypt</span></span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span>\n    cipher <span class=\"token operator\">=</span> <span class=\"token constant\">OpenSSL</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Cipher</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">AES</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:GCM</span><span class=\"token punctuation\">)</span>\n    cipher<span class=\"token punctuation\">.</span>encrypt\n    cipher<span class=\"token punctuation\">.</span>key <span class=\"token operator\">=</span> key\n    cipher<span class=\"token punctuation\">.</span>iv <span class=\"token operator\">=</span> vector\n\n    encrypted <span class=\"token operator\">=</span> cipher<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">.</span>to_s<span class=\"token punctuation\">)</span>\n    encrypted <span class=\"token operator\">&lt;</span><span class=\"token operator\">&lt;</span> cipher<span class=\"token punctuation\">.</span>final\n\n    encoded <span class=\"token operator\">=</span> <span class=\"token constant\">Base64</span><span class=\"token punctuation\">.</span>urlsafe_encode64<span class=\"token punctuation\">(</span>encrypted<span class=\"token punctuation\">)</span>\n\n    <span class=\"token punctuation\">{</span>\n      content<span class=\"token punctuation\">:</span> encoded<span class=\"token punctuation\">,</span>\n      tag<span class=\"token punctuation\">:</span>  <span class=\"token constant\">Base64</span><span class=\"token punctuation\">.</span>urlsafe_encode64<span class=\"token punctuation\">(</span>cipher<span class=\"token punctuation\">.</span>auth_tag<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">end</span>\n\n  <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">decrypt</span></span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> tag<span class=\"token punctuation\">)</span>\n    cipher <span class=\"token operator\">=</span> <span class=\"token constant\">OpenSSL</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">Cipher</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">AES</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:GCM</span><span class=\"token punctuation\">)</span>\n    cipher<span class=\"token punctuation\">.</span>decrypt\n    cipher<span class=\"token punctuation\">.</span>key <span class=\"token operator\">=</span> key\n    cipher<span class=\"token punctuation\">.</span>iv <span class=\"token operator\">=</span> vector\n\n    cipher<span class=\"token punctuation\">.</span>auth_tag <span class=\"token operator\">=</span> <span class=\"token constant\">Base64</span><span class=\"token punctuation\">.</span>urlsafe_decode64<span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">)</span>\n\n    decoded <span class=\"token operator\">=</span> <span class=\"token constant\">Base64</span><span class=\"token punctuation\">.</span>urlsafe_decode64<span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span>\n    decrypted <span class=\"token operator\">=</span> cipher<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>decoded<span class=\"token punctuation\">)</span>\n    decrypted\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h1>Example of how to use it:</h1>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">cs <span class=\"token operator\">=</span> <span class=\"token constant\">CipherService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">:</span> <span class=\"token constant\">SecureRandom</span><span class=\"token punctuation\">.</span>urlsafe_base64<span class=\"token punctuation\">(</span><span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> vector<span class=\"token punctuation\">:</span> <span class=\"token constant\">SecureRandom</span><span class=\"token punctuation\">.</span>urlsafe_base64<span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nenc <span class=\"token operator\">=</span> cs<span class=\"token punctuation\">.</span>encrypt<span class=\"token punctuation\">(</span><span class=\"token string\">'test me'</span><span class=\"token punctuation\">)</span>\ncs<span class=\"token punctuation\">.</span>decrypt<span class=\"token punctuation\">(</span>enc<span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"title":"Ruby create a cipher","date":"November 23, 2020","description":"How to create a cipher in ruby.","author":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/ruby/create-a-cipher/","previous":{"fields":{"slug":"/ruby/factory-bot/sequence/"},"frontmatter":{"title":"Factory bot sequence","tags":["ruby","ruby-on-rails"]}},"next":{"fields":{"slug":"/arduino/adafruit-bno055-imu/"},"frontmatter":{"title":"Arduino Adafruit BNO055 IMU","tags":["arduino"]}}}}}