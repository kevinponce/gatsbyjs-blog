{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/heroku-scale-dyno-from-ruby/","result":{"data":{"site":{"siteMetadata":{"title":"Kevin Ponce Blog","author":"Kevin Ponce"}},"markdownRemark":{"id":"64c4f67c-7546-5224-9ce7-a276df4b02f3","excerpt":"I recently was working a project that requires a million+ jobs to process data.\nIn order to process the data in a timely fashion I need to have a lot of workers…","html":"<p>I recently was working a project that requires a million+ jobs to process data.\nIn order to process the data in a timely fashion I need to have a lot of workers, but I do not want to pay for them to run 24-7.\nI could manually scale them up before going to bed and turn them off when I go to bed, but I do want to manual do this.\nHeroku has an api that will allow me to scale the dyno up and down but was a little confusing to figure out at first.</p>\n<p>I started looking through the Dyno section and there was nothing to update the count…\nIt turns out they thought it would be a great idea to call it formation…</p>\n<p>Before you are able to use the code below, you must configure environment variable for <code class=\"language-text\">HEROKU_OAUTH_TOKEN</code> and <code class=\"language-text\">HEROKU_APP_NAME</code>.</p>\n<h2>Heroku oAuth Token</h2>\n<p>To get a heroku oAuth token, you must run the following commands in terminal or go to <code class=\"language-text\">https://dashboard.heroku.com/account/applications</code> and create a new authorization.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">heroku plugins:install heroku-cli-oauth\nheroku authorizations:create -d &quot;Platform API example token&quot;</code></pre></div>\n<h2>App name</h2>\n<p><code class=\"language-text\">HEROKU_APP_NAME</code> is whatever you named the app on heroku that you want to control.</p>\n<h2>Fetching Count</h2>\n<p>Here is a snippet to fetch the count of dynos:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'platform-api'</span>\n\nheroku <span class=\"token operator\">=</span> <span class=\"token constant\">PlatformAPI</span><span class=\"token punctuation\">.</span>connect_oauth<span class=\"token punctuation\">(</span><span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'HEROKU_OAUTH_TOKEN'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nheroku<span class=\"token punctuation\">.</span>formation<span class=\"token punctuation\">.</span>info<span class=\"token punctuation\">(</span><span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'HEROKU_APP_NAME'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'quantity'</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Updating Count</h2>\n<p>Here is a snippet to update the count of dynos:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string\">'platform-api'</span>\n\nheroku <span class=\"token operator\">=</span> <span class=\"token constant\">PlatformAPI</span><span class=\"token punctuation\">.</span>connect_oauth<span class=\"token punctuation\">(</span><span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'HEROKU_OAUTH_TOKEN'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nheroku<span class=\"token punctuation\">.</span>formation<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">'HEROKU_APP_NAME'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> quantity<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"title":"Heroku Scale Dyno From Ruby","date":"2020-01-23T22:12:00.121Z","description":"How to scale Heroku dynos from ruby to make sure you are always able to handle the demand.","author":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/heroku-scale-dyno-from-ruby/","previous":{"fields":{"slug":"/parse-large-csv-file/"},"frontmatter":{"title":"Parse Large CSV File","tags":["ruby","ruby-on-rails"]}},"next":{"fields":{"slug":"/monitor-resque-in-code/"},"frontmatter":{"title":"Monitor Resque In Code","tags":["ruby","ruby-on-rails"]}}}}}